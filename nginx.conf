# nginx.conf
# This file configures Nginx to serve a React single page app (SPA)
# built into static files under /usr/share/nginx/html.

server {
  # Nginx listens inside the container on port 80.
  # You will map host port 5575 to 80 when you run the container.
  listen 80;
  server_name _;

  # The folder where the React build is copied by the Dockerfile
  root /usr/share/nginx/html;

  # Default file to serve when a directory path is requested
  index index.html;

  # Hide Nginx version in error pages and headers
  server_tokens off;

  # ---------- Main route block ----------
  # Serve real files if they exist. If not, fall back to index.html so
  # the client side router (React Router) can handle the route.
  location / {
    # Order matters:
    # 1) try the exact file
    # 2) try a directory index
    # 3) fall back to index.html for SPA routes like /work, /skills
    try_files $uri $uri/ /index.html;
  }

  # ---------- Static assets ----------
  # Serve versioned assets and common static files directly.
  # Add light caching and turn off access logs for these requests.
  location ~* \.(?:js|css|png|jpg|jpeg|gif|svg|webp|ico|woff2?)$ {
    # Only serve if the file exists. Otherwise return 404.
    try_files $uri =404;

    # Cache static assets for 7 days
    expires 7d;
    add_header Cache-Control "public, max-age=604800, immutable";

    # Reduce noise in logs for asset requests
    access_log off;
  }

  # ---------- Gzip compression ----------
  # Improves transfer size for text assets. Safe defaults.
  gzip on;
  gzip_comp_level 5;           # balance between CPU and size
  gzip_min_length 1024;        # do not gzip tiny files
  gzip_proxied any;
  gzip_vary on;
  gzip_types
    text/plain
    text/css
    text/javascript
    application/javascript
    application/json
    application/xml
    application/rss+xml
    application/vnd.ms-fontobject
    application/font-woff
    application/font-woff2
    font/woff
    font/woff2
    image/svg+xml;

  # ---------- Optional security headers ----------
  # Uncomment if you want these. Keep Content-Security-Policy simple
  # unless you know your exact needs.
  # add_header X-Content-Type-Options "nosniff" always;
  # add_header X-Frame-Options "SAMEORIGIN" always;
  # add_header Referrer-Policy "strict-origin-when-cross-origin" always;
  # add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;" always;
}
